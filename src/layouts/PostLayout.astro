---
import BaseLayout from './BaseLayout.astro';
import { tagDotClass } from '../utils/tagColor';

interface Props {
  title: string;
  date?: Date;
  tags?: string[];
  summary?: string;
  backLink: string;
  backLabel: string;
}

const { title, date, tags = [], summary, backLink, backLabel } = Astro.props;

const articleSchema: Record<string, unknown> = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "author": {
    "@type": "Organization",
    "name": "Valori"
  },
  "publisher": {
    "@type": "Organization",
    "name": "SOFT CAT .ai",
    "url": "https://softcat.ai"
  },
  "url": Astro.url.href,
};

if (date) articleSchema["datePublished"] = date.toISOString();
if (summary) articleSchema["description"] = summary;
if (tags.length > 0) articleSchema["keywords"] = tags.join(", ");
---

<BaseLayout title={title} description={summary}>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  </Fragment>
  <article class="max-w-3xl mx-auto px-6 py-16">
    <a
      href={backLink}
      class="inline-flex items-center gap-2 text-text-muted hover:text-neon-cyan font-mono text-sm mb-8 transition-colors"
    >
      <span>&larr;</span>
      <span>{backLabel}</span>
    </a>

    <header class="mb-10">
      <h1 class="font-mono text-3xl md:text-4xl font-bold text-text-bright mb-4 glow-green">
        {title}
      </h1>

      <div class="flex flex-wrap items-center gap-4 text-sm text-text-muted">
        {date && (
          <time datetime={date.toISOString()} class="font-mono">
            {date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}
          </time>
        )}
        {tags.length > 0 && (
          <div class="flex flex-wrap gap-2">
            {tags.map((tag) => (
              <a href={`/tags/${tag}`} class="tag-badge">
                <span class={`tag-dot ${tagDotClass(tag)}`}></span>
                {tag}
              </a>
            ))}
          </div>
        )}
      </div>

      {summary && (
        <p class="mt-4 text-text-muted text-lg leading-relaxed">{summary}</p>
      )}
    </header>

    <div class="prose text-text-primary">
      <slot />
    </div>
  </article>
</BaseLayout>
